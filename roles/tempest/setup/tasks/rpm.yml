- name: Install tempest RPM
  yum:
    name=openstack-tempest
    state=present
  become: yes

- name: Ensures ~/tempest dir exists
  file:
    path="{{ tempest_cwd }}"
    state=directory

- name: Get the script which configures the tempest directory
  shell: ls -d /usr/share/openstack-tempest-*/tools/configure-tempest-directory
  register: configure_tempest_dir
  ignore_errors: true

- name: Initialize tempest workspace directory
  command: "{{ configure_tempest_dir.stdout_lines[0] }}"
  args:
      chdir: "{{ tempest_cwd }}"
      creates: "{{ tempest_cwd }}/LICENSE"
  when: configure_tempest_dir.rc == 0

- name: Initialize tempest workspace directory using tempest init
  command: "tempest init"
  args:
      chdir: "{{ tempest_cwd }}"
      creates: "{{ tempest_cwd }}/etc"
  when: configure_tempest_dir.rc != 0
