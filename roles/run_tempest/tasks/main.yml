- name: Run testr init
  shell: "tempest/venv testr init"
  args:
    creates: "tempest/.testrepository"

- name: Run Tempest
  shell: "tempest/venv ./tools/run-tests.sh --parallel --concurrency={{ tempest_concurrency | default('4') }} {{ tempest_regex | default('') }}"
  ignore_errors: true
  
- name: Fetch Tempest results
  fetch:
    src=/home/stack/tempest/tempest.xml
    dest={{ lookup('env', 'PWD') }}/nosetests.xml
    flat=yes